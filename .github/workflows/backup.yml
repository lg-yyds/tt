name: Backup Project

on:
  workflow_dispatch:  # 手动触发
  schedule:
    - cron: '0 0 * * *'  # 每天 0 点自动触发备份任务，你可以根据需要修改时间

jobs:
  backup:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Create backup directory
      run: |
        mkdir -p blackup

    - name: Backup and compress the project
      run: |
        # 使用 --exclude 排除一些常见的动态文件夹（例如 .git 和 node_modules）
        tar --exclude='.git' --exclude='node_modules' --exclude='*.log' --warning=no-file-changed -czf blackup/project-backup-$(date +'%Y-%m-%d_%H-%M-%S').tar.gz .

    - name: Commit backup to repository
      run: |
        git add blackup/
        git commit -m "Add project backup on $(date +'%Y-%m-%d_%H-%M-%S')"
        git push
